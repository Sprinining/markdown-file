

# R102S接口协议

## 一、数据传输格式

- 数据开头 0x55

- 数据结尾 0xAA

- 传输的数据格式： 0x55 +  json 格式数据  + 0xAA

## 二、连接方式

1、串口连接

 根据串口地址（固定：/dev/ttyHS1）、波特率连接（默认：115200）、打开方式（固定：可读可写）

2、TCP/IP网口连接

根据IP、端口号（默认：8088）连接

3、广播连接

```java
// 从客户端发给服务器的intentFilter.addAction()中的字符串
public static final String ACTION_SEND_CMD = "action_send_cmd"; 
// 服务器返还给客户端intentFilter.addAction()中的字符串
public static final String ACTION_SEND_RESULT = "action_send_result"; 
```

4、蓝牙连接

通过UUID和服务器蓝牙设备的mac地址建立连接

```java
// 服务器和客户端必须一致，类似于tcp/ip通信时socket的端口
public static final UUID MY_UUID = UUID.fromString();
// mac类似于ip地址
String macAddress = "64:F6:BB:3B:57:13"；
```

目前是service运行后，打开蓝牙可见性，直到第一个客户端连上后，立刻关闭用于监听的bluetoothServerSocket和蓝牙可见性（除非需要连接很多客户端）。

## 三、PC上位机和设备Android

## 服务通信接口

关闭串口连接（预留）

关闭TCP/IP连接（预留）

### 1、获取读写器版本号

- PC发送：（cmd为命令编号）

```json
{
  "cmd": 1
}
```

- 设备返回：

```json
{
  "cmd": 1,
  "data": {
    "bootver": "15.01.04.00",
    "err": 0,
    "firmdata": "20.20.07.29",
    "firmver": "20.07.29.00",
    "hardver": "A1.00.02.01"
  },
  "statusCode": 0
}
```

说明："hardVer" 硬件版本号；"firmVer"固件版本号

### 2、获取频段

- PC发送：

```json
{
  "cmd": 2 
}
```

- 设备返回：

```json
{
  "cmd": 2,
  "data": {
    "arrRegion": [
      "RG_NA"
    ],
    "err": 0
  },
  "statusCode": 0
}
```

说明："RG_NA" 北美 ； "RG_PRC" 中国

### 3、设置频段

- PC发送：

```json
{
  "cmd": 3,
  "data": "RG_PRC"
}
```

- 设备返回：

```json
{
  "cmd": 3,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 4、获取输出功率

- PC发送：

```json
{
  "cmd": 4
}
```

- 设备返回：

```json
{
  "cmd": 4,
  "data": {
    "antPowerConf": {
      "Powers": [
        {
          "antid": 1,
          "readPower": 3000,
          "writePower": 3000
        },
        {
          "antid": 2,
          "readPower": 3000,
          "writePower": 3000
        },
        {
          "antid": 3,
          "readPower": 3000,
          "writePower": 3000
        },
        {
          "antid": 4,
          "readPower": 3000,
          "writePower": 3000
        },
        {
          "antid": 5,
          "readPower": 3000,
          "writePower": 3000
        },
        {
          "antid": 6,
          "readPower": 3000,
          "writePower": 3000
        },
        {
          "antid": 7,
          "readPower": 3000,
          "writePower": 3000
        },
        {
          "antid": 8,
          "readPower": 3000,
          "writePower": 3000
        },
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null
      ],
      "antcnt": 8
    },
    "err": 0
  },
  "statusCode": 0
}
```

### 5、设置输出功率

- PC发送：

```json
{
  "cmd": 5,
  "data": 33
}
```

data：输出功率，int型，单位dBm。

- 设备返回：

```json
{
  "cmd": 5,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 6、获取session

- PC发送：

```json
{
  "cmd": 6
}
```

- 设备返回：

```json
{
  "cmd": 6,
  "data": {
    "data": [
      0
    ],
    "err": 0
  },
  "statusCode": 0
}
```

data：session值，值为int型。

### 7、设置session

- PC发送：

```json
{
  "cmd": 7,
  "data": 1
}
```

data：session值，int型。

- 设备返回：

```json
{
  "cmd": 7,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 8、获取profile

- PC发送：

```json
{
  "cmd": 8
}
```

- 设备返回：

```json
{
  "cmd": 8,
  "data": {
    "data": [
      2
    ],
    "err": 0
  },
  "statusCode": 0
}
```

data：profile值，值为int型。

### 9、设置profile

- PC发送：

```json
{
  "cmd": 9,
  "data": 1
}
```

data：profile值，int型。

- 设备返回：

```json
{
  "cmd": 9,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 10、获取target

- PC发送：

```json
{
  "cmd": 10
}
```

- 设备返回：

```json
{
  "cmd": 10,
  "data": {
    "data": [
      0
    ],
    "err": 0
  },
  "statusCode": 0
}
```

data：target值，值为int型。

### 11、设置target

- PC发送：

```json
{
  "cmd": 11,
  "data": 1
}
```

data：target值，int型。

- 设备返回：

```json
{
  "cmd": 11,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 12、获取Q值（QValue）

- PC发送：

```json
{
  "cmd": 12
}
```

- 设备返回：

```json
{
  "cmd": 12,
  "data": {
    "data": [
      -1
    ],
    "err": 0
  },
  "statusCode": 0
}
```

data：返回的是Q值，值为int型

### 13、设置Q值（QValue）

- PC发送：

```json
{
  "cmd": 13,
  "data": 4
}
```

data：Q值，int型

- 设备返回：

```json
{
  "cmd": 13,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 14、获取gpio

- PC发送：

```json
{
  "cmd": 14
}
```

- 设备返回：

```json
{
  "cmd": 14,
  "data": {
    "data": [
      1
    ],
    "err": 0
  },
  "statusCode": 0
}
{
  "cmd": 14,
  "data": {
    "IN1":0，
    "IN2":1，
    "IN3":0，
    "IN4":0，
    "err": 0
  },
  "statusCode": 0
}
{
	"cmd": 14,
	"data": {
		"data": [0, 1, 0, 0],
		"err": 0
	},
	"statusCode": 0
}
```

说明：data数组为[IN1,IN2,IN3,IN4]，1表示高低电平，0为低电平

### 15、设置gpio

- PC发送：

```json
{
  "cmd": 15,
  "data": {
    "gpoId": "1",
    "gpo": "0"
  }
}
```

data:gpoId范围1到4：1表示OUT1、2表示OUT2...

gpo状态值：1为高电平，0为低电平

- 设备返回：

```json
{
  "cmd": 15,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 16、获取是否天线检测

- PC发送：

```json
{
  "cmd": 16
}
```

- 设备返回：

```json
{
  "cmd": 16,
  "data": {
    "data": [
      1
    ],
    "err": 0
  },
  "statusCode": 0
}
```

data:需要天线检测，返回值为1，否则返回0

### 17、设置是否天线检测

- PC发送：

```json
{
  "cmd": 17,
  "data": 1
}
```

data:需要天线检测，值设置为1。不需要，则设0。

- 设备返回：

```json
{
  "cmd": 17,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 18、获取指定盘点天线配置

- PC发送：

```json
{
  "cmd": 18
}
```

- 设备返回：

```json
{
  "cmd": 18,
  "data": {
    "connantsSt": {
      "antcnt": 0,
      "connectedants": [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ]
    },
    "err": 0
  },
  "statusCode": 0
}
```

### 19、获取温度

- PC发送：

```json
{
  "cmd": 19
}
```

- 设备返回：

```json
{
  "cmd": 19,
  "data": {
    "data": [
      35
    ],
    "err": 0
  },
  "statusCode": 0
}
```

### 20、设置过滤

- PC发送：

```json
{
  "cmd": 20,
  "param": {
    "sdt": "32",
    "bank": 1,
    "data": "11",
    "suit": true,
    "enable": true
  }
}
```

- 设备返回：

```json
{
  "cmd": 20,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 21、读卡操作

- PC发送：

```json
{
  "cmd": 21,
  "param": {
    "antnna": 1,
    "bank": 1,
    "blkcnt": 6,
    "address": 2,
    "accessWord": "00000000"
  }
}
```

- 设备返回：

```json
{
  "cmd": 21,
  "data": {
    "data": [
      18,
      52,
      86,
      120,
      -35,
      -39,
      1,
      64,
      0,
      0,
      0,
      56
    ],
    "err": 0
  },
  "statusCode": 0
}
```

说明：调用“读卡操作”之前，先调用“设置过滤”接口，才会生效。

### 22、写卡操作

- PC发送：

```json
{
  "cmd": 22,
  "param": {
    "antnna": 1,
    "bank": 1,
    "data": "ABC31",
    "address": 2,
    "accessWord": "00000000"
  }
}
```

- 设备返回：

```json
{
  "cmd": 22,
  "data": 0,
  "statusCode": 0
}
```

说明：调用“写卡操作”之前，先调用“设置过滤”接口，才会生效。

data：err的int值。

### 23、锁卡操作(没测试过)

- PC发送：

```json
{
  "cmd": 23,
  "param": {
    "antnna": 1,
    "lbank": 1,
    "ltype": 1,
    "accessWord": "00000000"
  }
}
```

- 设备返回：

```json

```

说明："ltype"为int型，取值范围：0解锁、 1暂时锁定、 2永久锁定

备注：调用“锁卡操作”之前，先调用“设置过滤”接口（命令编号21），才会生效。

### 24、销毁操作(没测试过)

- PC发送：

```json
{
  "cmd": 24,
  "param": {
    "antnna": 1,
    "accessWord": "00000000"
  }
}
```

- 设备返回：

```json

```

说明：

备注：调用“销毁操作”之前，先调用“设置过滤”接口（命令编号21），才会生效。

### 25、单次寻卡

- PC发送：

```json
{
  "cmd": 25
}
```

- 设备返回：

```json
{
  "cmd": 25,
  "data": {
    "additionalData": "",
    "antenna": "1",
    "epcId": "12345678DDD9014000000038",
    "err": 0,
    "rssi": -41
  },
  "statusCode": 0
}
```

### 26、连续寻卡

- PC发送：

```json
{
  "cmd": 26
}
```

- 设备返回：

```json
{
  "cmd": 26,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 27、停止寻卡

- PC发送：

```json
{
  "cmd": 27
}
```

- 设备返回：

```json
{
  "cmd": 27,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 28、获取附加数据

- PC发送：

```json
{
  "cmd": 28
}
```

- 设备返回：

```json
{
  "cmd": 28,
  "data": {
    "data": {
      "bank": 0,
      "bytecnt": 0,
      "startaddr": 0
    },
    "err": 0
  },
  "statusCode": 0
}
```

### 29、设置附加数据

- PC发送：

```json
{
  "cmd": 29,
  "param": {
    "st": "",
    "ct": "",
    "bank": 1,
    "pwd": ""
  }
}
```

- 设备返回：

```json
{
  "cmd": 29,
  "data": 0,
  "statusCode": 0
}
```

data：err的int值。

### 30、断开串口和网口连接(有bug)(弃用)

- PC发送：

```json
{
  "cmd": 30
}
```

- 设备返回：

```json
{
  "cmd": 30,
  "data": "exit success",
  "statusCode": 0
}
```

### 31、设置串口路径，波特率，读写方式并重新打开端口

- 如果是从串口发送这条命令，修改完串口波特率后，串口是收不到本次命令的返回信息的。

- PC发送：

```json
{
  "cmd": 31,
  "data": {
    "serialPath": "/dev/ttyHS1",
    "baudRate": 4800,
    "flags": 2
  }
}
```

- 设备返回：

```json
{
  "cmd": 31,
  "data": "serialPath:/dev/ttyHS1, baudRate:4800, flag:2",
  "statusCode": 0
}
```

### 32、设置socket通信的端口，并重启服务器

- socket客户端发出此命令后，可能会收不到返回信息，小概率能收到。

- PC发送：

```json
{
  "cmd": 32,
  "data": 8888
}
```

- 设备返回：

```json
{
  "cmd": 32,
  "data": "new port:8888",
  "statusCode": 0
}
```

### 33、一键获取参数

- PC发送：

```json
{
  "cmd": 33
}
```

- 设备返回：

```json
{
  "cmd": 33,
  "data": {
    "getVersion": {
      "cmd": 1,
      "data": {
        "bootver": "15.01.04.00",
        "err": 0,
        "firmdata": "20.20.07.29",
        "firmver": "20.07.29.00",
        "hardver": "A1.00.02.01"
      },
      "statusCode": 0
    },
    "getInvantAnt": {
      "cmd": 18,
      "data": {
        "connantsSt": {
          "antcnt": 0,
          "connectedants": [
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0
          ]
        },
        "err": 0
      },
      "statusCode": 0
    },
    "getTarget": {
      "cmd": 10,
      "data": {
        "data": [
          0
        ],
        "err": 0
      },
      "statusCode": 0
    },
    "getQValue": {
      "cmd": 12,
      "data": {
        "data": [
          -1
        ],
        "err": 0
      },
      "statusCode": 0
    },
    "getGpi": {
      "cmd": 14,
      "data": {
        "data": [
          1
        ],
        "err": 0
      },
      "statusCode": 0
    },
    "getPower": {
      "cmd": 4,
      "data": {
        "antPowerConf": {
          "Powers": [
            {
              "antid": 1,
              "readPower": 3000,
              "writePower": 3000
            },
            {
              "antid": 2,
              "readPower": 3000,
              "writePower": 3000
            },
            {
              "antid": 3,
              "readPower": 3000,
              "writePower": 3000
            },
            {
              "antid": 4,
              "readPower": 3000,
              "writePower": 3000
            },
            {
              "antid": 5,
              "readPower": 3000,
              "writePower": 3000
            },
            {
              "antid": 6,
              "readPower": 3000,
              "writePower": 3000
            },
            {
              "antid": 7,
              "readPower": 3000,
              "writePower": 3000
            },
            {
              "antid": 8,
              "readPower": 3000,
              "writePower": 3000
            },
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null
          ],
          "antcnt": 8
        },
        "err": 0
      },
      "statusCode": 0
    },
    "getRegion": {
      "cmd": 2,
      "data": {
        "arrRegion": [
          "RG_NA"
        ],
        "err": 0
      },
      "statusCode": 0
    },
    "getEmbededData": {
      "cmd": 28,
      "data": {
        "data": {
          "bank": 0,
          "bytecnt": 0,
          "startaddr": 0
        },
        "err": 0
      },
      "statusCode": 0
    },
    "getWhetherCheckAnt": {
      "cmd": 16,
      "data": {
        "data": [
          1
        ],
        "err": 0
      },
      "statusCode": 0
    },
    "getProfile": {
      "cmd": 8,
      "data": {
        "data": [
          2
        ],
        "err": 0
      },
      "statusCode": 0
    },
    "getSession": {
      "cmd": 6,
      "data": {
        "data": [
          0
        ],
        "err": 0
      },
      "statusCode": 0
    },
    "getTemperature": {
      "cmd": 19,
      "data": {
        "data": [
          35
        ],
        "err": 0
      },
      "statusCode": 0
    }
  },
  "statusCode": 0
}
```

### 34、一键设置参数

- PC发送：

```json
{
  "cmd": 34,
  "params": {
    "setRegion": {
      "cmd": 3,
      "data": "RG_PRC"
    },
    "setPower": {
      "cmd": 5,
      "data": 33
    },
    "setSession": {
      "cmd": 7,
      "data": 1
    },
    "setProfile": {
      "cmd": 9,
      "data": 1
    },
    "setTarget": {
      "cmd": 11,
      "data": 1
    },
    "setQValue": {
      "cmd": 13,
      "data": 4
    },
    "setGpo": {
      "cmd": 15,
      "data": {
        "gpold": 1,
        "gpo": 0
      }
    },
    "setWhetherCheckAnt": {
      "cmd": 17,
      "data": 1
    },
    "setFilter": {
      "cmd": 20,
      "param": {
        "sdt": "32",
        "bank": 1,
        "data": "11",
        "suit": true,
        "enable": true
      }
    },
    "setEmbededData": {
      "cmd": 29,
      "param": {
        "st": "",
        "ct": "",
        "bank": 1,
        "pwd": ""
      }
    }
  }
}
```

- 设备返回：

```json
{
  "cmd": 34,
  "data": {
    "setRegion": {
      "cmd": 3,
      "data": 0,
      "statusCode": 0
    },
    "setWhetherCheckAnt": {
      "cmd": 17,
      "data": 0,
      "statusCode": 0
    },
    "setGpo": {
      "cmd": 15,
      "data": 0,
      "statusCode": 0
    },
    "setPower": {
      "cmd": 5,
      "data": 0,
      "statusCode": 0
    },
    "setTarget": {
      "cmd": 11,
      "data": 0,
      "statusCode": 0
    },
    "setProfile": {
      "cmd": 9,
      "data": 0,
      "statusCode": 0
    },
    "setSession": {
      "cmd": 7,
      "data": 0,
      "statusCode": 0
    },
    "setQValue": {
      "cmd": 13,
      "data": 0,
      "statusCode": 0
    },
    "setEmbededData": {
      "cmd": 29,
      "data": 0,
      "statusCode": 0
    },
    "setFilter": {
      "cmd": 20,
      "data": 0,
      "statusCode": 0
    }
  },
  "statusCode": 0
}
```

## 状态码StatusCode

```java
public class StatusCode {
    public static final int CHECK_OK = 0;           // 数据校验成功
    public static final int CHECK_ERROR = 1;        // 数据校验错误(头尾不是0x55和0xAA)
    public static final int JSON_FORMAT_ERROR = 2;  // json格式错误
    public static final int JSON_FIELD_ERROR = 3;   // json字段错误
    public static final int CMD_ERROR = 4;          // 命令编号错误
}
```

